<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Simple Metronome</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #222;
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }

    h1 {
      margin-bottom: 20px;
    }

    button {
      padding: 10px 20px;
      font-size: 18px;
      cursor: pointer;
    }

    input[type="range"] {
      width: 80vw;
      margin-top: 20px;
    }

    .tempo-display {
      margin-top: 10px;
      font-size: 20px;
    }
  </style>
</head>
<body>
  <h1>Metronome</h1>
  <button id="toggleButton">Start</button>
  <input type="range" id="tempoSlider" min="40" max="240" value="120">
  <div class="tempo-display">Tempo: <span id="tempoValue">120</span> BPM</div>

  <script>
    const toggleButton = document.getElementById('toggleButton');
    const tempoSlider = document.getElementById('tempoSlider');
    const tempoValue = document.getElementById('tempoValue');

    let isRunning = false;
    let intervalId = null;
    let bpm = parseInt(tempoSlider.value);

    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

	var idx = 0;
    function playClick() {
		if(idx%4 == 0 || idx < 7 || idx == 9 ) {
		  const oscillator = audioCtx.createOscillator();
		  const envelope = audioCtx.createGain();

		  oscillator.type = 'square';
		  oscillator.frequency.setValueAtTime(1000, audioCtx.currentTime);
		  envelope.gain.setValueAtTime(1, audioCtx.currentTime);
		  envelope.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.05);

		  oscillator.connect(envelope);
		  envelope.connect(audioCtx.destination);

		  oscillator.start(audioCtx.currentTime);
		  oscillator.stop(audioCtx.currentTime + 0.05);
		}
		idx +=1;
    }
 
    function startMetronome() {
      const interval = (60 / bpm) * 1000;
      playClick();
      intervalId = setInterval(playClick, interval);
    }

    function stopMetronome() {
      clearInterval(intervalId);
      intervalId = null;
	  idx = 0;
    }

    toggleButton.addEventListener('click', () => {
      if (!isRunning) {
        startMetronome();
        toggleButton.textContent = 'Stop';
        isRunning = true;
      } else {
        stopMetronome();
        toggleButton.textContent = 'Start';
        isRunning = false;
      }
    });

    tempoSlider.addEventListener('input', () => {
      bpm = parseInt(tempoSlider.value);
      tempoValue.textContent = bpm;

      if (isRunning) {
        stopMetronome();
        startMetronome();
      }
    });
  </script>
</body>
</html>
